# Goè¨€èªã‚¯ã‚¤ã‚ºå¤§ä¼šã‚·ã‚¹ãƒ†ãƒ  WebSocket ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡æ©Ÿèƒ½å®Ÿè£… TODO

## æ¦‚è¦
Goè¨€èªã§WebSocketã‚’ä½¿ç”¨ã—ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡æ©Ÿèƒ½ã‚’å®Ÿè£…

## è¦ä»¶
- æœ€å¤§70äººã®åŒæ™‚æ¥ç¶šå¯¾å¿œ
- å•é¡Œåˆ‡ã‚Šæ›¿ãˆé€šçŸ¥
- æŠ•ç¥¨çµ‚äº†é€šçŸ¥
- ç¾åœ¨ã®å›ç­”çŠ¶æ³ã®ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ
- gorilla/websocketã‚’ä½¿ç”¨

## TODOä¸€è¦§

### [å®Œäº†] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ èª¿æŸ»
- DDDè¨­è¨ˆã«å¾“ã£ãŸæ§‹é€ ç¢ºèª
- internal/handlers/websocket.go ãŒæ—¢ã«å­˜åœ¨

### [å®Œäº†] gorilla/websocketã®ä¾å­˜é–¢ä¿‚ç¢ºèªãƒ»è¿½åŠ 
- go.mod ã« github.com/gorilla/websocket v1.5.3 ãŒæ—¢ã«è¿½åŠ æ¸ˆã¿

### [å®Œäº†] WebSocketãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹ã®å®šç¾©
- WebSocketMessage, SubscribeMessage, QuestionSwitchNotification, VotingEndNotification, AnswerStatusUpdate ãŒå®šç¾©æ¸ˆã¿

### [å®Œäº†] WebSocketæ¥ç¶šç®¡ç†æ©Ÿèƒ½ã®å®Ÿè£…
- ClientConnectionæ§‹é€ ä½“ã¨connections mapã§ç®¡ç†
- æœ€å¤§70äººã®æ¥ç¶šåˆ¶é™å®Ÿè£…æ¸ˆã¿
- ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆæ©Ÿèƒ½å®Ÿè£…æ¸ˆã¿

### [å®Œäº†] ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆæ©Ÿèƒ½ã®å®Ÿè£…
- BroadcastResultUpdate, BroadcastSessionUpdate å®Ÿè£…æ¸ˆã¿

### [å®Œäº†] å•é¡Œåˆ‡ã‚Šæ›¿ãˆé€šçŸ¥æ©Ÿèƒ½ã®å®Ÿè£…
- BroadcastQuestionSwitch å®Ÿè£…æ¸ˆã¿

### [å®Œäº†] æŠ•ç¥¨çµ‚äº†é€šçŸ¥æ©Ÿèƒ½ã®å®Ÿè£…
- BroadcastVotingEnd å®Ÿè£…æ¸ˆã¿

### [å®Œäº†] å›ç­”çŠ¶æ³ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆæ©Ÿèƒ½ã®å®Ÿè£…
- BroadcastAnswerStatus å®Ÿè£…æ¸ˆã¿

### [å®Œäº†] æœ€å¤§æ¥ç¶šæ•°åˆ¶é™ï¼ˆ70äººï¼‰ã®å®Ÿè£…
- MaxConnectionså®šæ•°ã§70ã«è¨­å®šæ¸ˆã¿
- WebSocketResultsé–¢æ•°ã§æ¥ç¶šæ•°ãƒã‚§ãƒƒã‚¯å®Ÿè£…æ¸ˆã¿

### [å®Œäº†] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ­ã‚°æ©Ÿèƒ½ã®å®Ÿè£…
- WebSocketæ¥ç¶šã‚¨ãƒ©ãƒ¼ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‚¨ãƒ©ãƒ¼ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…æ¸ˆã¿
- CleanupConnections ã§å¤ã„æ¥ç¶šã®è‡ªå‹•å‰Šé™¤æ©Ÿèƒ½å®Ÿè£…æ¸ˆã¿

## æˆæœç‰©

### WebSocketå®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½
- **æ¥ç¶šç®¡ç†**: `/ws` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§WebSocketæ¥ç¶š
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—**:
  - `subscribe`: ã‚¯ã‚¤ã‚ºIDã‚’æŒ‡å®šã—ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã‚’è³¼èª­
  - `unsubscribe`: è³¼èª­è§£é™¤
  - `heartbeat`: æ¥ç¶šç¶­æŒç”¨ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ
  - `result_update`: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµæœæ›´æ–°
  - `session_update`: ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹æ›´æ–°
  - `question_switch`: å•é¡Œåˆ‡ã‚Šæ›¿ãˆé€šçŸ¥
  - `voting_end`: æŠ•ç¥¨çµ‚äº†é€šçŸ¥
  - `answer_status`: å›ç­”çŠ¶æ³ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°

### APIé€£æºæ©Ÿèƒ½
- `BroadcastQuestionSwitch(quizID, questionNumber, totalQuestions)`: å•é¡Œåˆ‡ã‚Šæ›¿ãˆé€šçŸ¥
- `BroadcastVotingEnd(quizID, questionID)`: æŠ•ç¥¨çµ‚äº†é€šçŸ¥
- `BroadcastAnswerStatus(quizID, questionID, totalParticipants, answeredCount, answerCounts)`: å›ç­”çŠ¶æ³é…ä¿¡
- `BroadcastResultUpdate(quizID)`: çµæœæ›´æ–°é…ä¿¡
- `GetConnectionCount()`: ç¾åœ¨ã®æ¥ç¶šæ•°å–å¾—
- `GetSubscriptionCount(quizID)`: ç‰¹å®šã‚¯ã‚¤ã‚ºã®è³¼èª­è€…æ•°å–å¾—

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- æœ€å¤§70äººåŒæ™‚æ¥ç¶šåˆ¶é™
- è‡ªå‹•æ¥ç¶šã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆ2åˆ†é–“ç„¡å¿œç­”ã§åˆ‡æ–­ï¼‰
- ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆæ©Ÿèƒ½ã«ã‚ˆã‚‹æ¥ç¶šç›£è¦–
- goroutineã«ã‚ˆã‚‹éåŒæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡

### [å®Œäº†] errcheck linting ã‚¨ãƒ©ãƒ¼ä¿®æ­£
- internal/handlers/participant.go: rows.Close(), Scan()ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¿®æ­£
- internal/handlers/results.go: rows.Close()ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¿®æ­£
- internal/handlers/session.go: db.QueryRow().Scan()ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¿®æ­£
- internal/handlers/upload.go: src.Close()ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¿®æ­£
- internal/handlers/websocket.go: conn.Close()ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¿®æ­£
- main.go: db.Close()ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¿®æ­£

### [å®Œäº†] revive linting ã‚¨ãƒ©ãƒ¼ä¿®æ­£ï¼ˆexported commentsï¼‰
- internal/database/database.go: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ã€PostgreSQLãƒ‰ãƒ©ã‚¤ãƒãƒ¼blank importã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
- internal/middleware/middleware.go: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
- internal/handlers/auth.go: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
- internal/services/auth_service.go: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ã€AuthServiceå‹ãƒ»exportedé–¢æ•°ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
- internal/services/quiz_service.go: QuizServiceå‹ãƒ»exportedé–¢æ•°ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
- internal/handlers/websocket.go: MaxConnectionså®šæ•°ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 

### [å®Œäº†] JWTèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…
- JWTã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãƒ»ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³æ©Ÿèƒ½
- ã‚»ã‚­ãƒ¥ã‚¢ãªç®¡ç†è€…èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
- Rate Limitingï¼ˆAPIä¿è­·ï¼‰
- CORSè¨­å®š
- ãƒˆãƒ¼ã‚¯ãƒ³ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆæ©Ÿèƒ½

#### å®Ÿè£…è©³ç´°
- **JWTèªè¨¼**: `internal/services/jwt_service.go` - ã‚¢ã‚¯ã‚»ã‚¹/ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆãƒ»æ¤œè¨¼
- **èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢**: `internal/middleware/middleware.go` - JWTèªè¨¼ã€Rate Limitingã€CORS
- **èªè¨¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼**: `internal/handlers/auth.go` - ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æš—å·åŒ–**: bcryptã«ã‚ˆã‚‹ã‚»ã‚­ãƒ¥ã‚¢ãªãƒãƒƒã‚·ãƒ¥åŒ–
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**: ãƒˆãƒ¼ã‚¯ãƒ³ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã€Rate Limitingï¼ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåˆ¥ï¼‰
- **ãƒ†ã‚¹ãƒˆ**: JWTæ©Ÿèƒ½ã®åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆå®Ÿè£…

#### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- `POST /api/auth/login` - ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³
- `POST /api/auth/refresh` - ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥  
- `POST /api/admin/logout` - ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
- `GET /api/admin/verify` - ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼

### [å®Œäº†] ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å‘ã‘å‚åŠ è€…ç”»é¢ï¼ˆNext.js 14ï¼‰ã®å®Ÿè£…
- ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ å…¥åŠ›ç”»é¢ã®ä½œæˆ
- å›ç­”ç”»é¢ï¼ˆA/B/C/D ã®4ã¤ã®å¤§ããªãƒœã‚¿ãƒ³ï¼‰ã®ä½œæˆ
- é¸æŠä¸­ã®å›ç­”ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºæ©Ÿèƒ½
- å›ç­”å¤‰æ›´å¯èƒ½æ©Ÿèƒ½ï¼ˆæŠ•ç¥¨çµ‚äº†ã¾ã§ï¼‰
- å¾…æ©Ÿç”»é¢ï¼ˆæ¬¡ã®å•é¡Œã¾ã§ï¼‰ã®ä½œæˆ
- æœ€çµ‚çµæœè¡¨ç¤ºç”»é¢ã®ä½œæˆ
- ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³å¯¾å¿œï¼ˆå¤§ããªãƒœã‚¿ãƒ³ã€é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã€èª­ã¿ã‚„ã™ã„ãƒ•ã‚©ãƒ³ãƒˆï¼‰

### [å®Œäº†] åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…
- **Goè¨€èªAPIå˜ä½“ãƒ†ã‚¹ãƒˆ**: ã‚¯ã‚¤ã‚ºCRUDã€å‚åŠ è€…ç®¡ç†ã€å›ç­”å‡¦ç†ã®ãƒ†ã‚¹ãƒˆ
- **Goè¨€èªçµ±åˆãƒ†ã‚¹ãƒˆ**: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆé–“ã®é€£æºã€èªè¨¼ãƒ•ãƒ­ãƒ¼ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºãƒ†ã‚¹ãƒˆ
- **WebSocketé€šä¿¡ãƒ†ã‚¹ãƒˆ**: åŒæ™‚æ¥ç¶šã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã€ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**: 70äººåŒæ™‚æ¥ç¶šã€ã‚·ã‚¹ãƒ†ãƒ è² è·ã€WebSocketè² è·ãƒ†ã‚¹ãƒˆ
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ**: Nuxt3ï¼ˆVitestï¼‰ã€Next.jsï¼ˆJestï¼‰ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
- **E2Eãƒ†ã‚¹ãƒˆ**: Cypress ã«ã‚ˆã‚‹ç®¡ç†è€…ãƒ»å‚åŠ è€…ãƒ»çµ±åˆãƒ•ãƒ­ãƒ¼ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆ
- **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒ**: Docker Composeå¯¾å¿œã€è‡ªå‹•ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ

## éå»ã®ä½œæ¥­å±¥æ­´
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã¯å®Œäº†æ¸ˆã¿:
- database_schema.sql: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒï¼ˆCREATE TABLEæ–‡ï¼‰
- er_diagram.md: ERå›³ï¼ˆMermaidè¨˜æ³•ï¼‰

WebSocketãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡æ©Ÿèƒ½ã¯å®Œäº†æ¸ˆã¿:
- internal/handlers/websocket.go: WebSocketæ©Ÿèƒ½å®Ÿè£…å®Œäº†
- internal/models/models.go: WebSocketé–¢é€£ãƒ¢ãƒ‡ãƒ«å®šç¾©å®Œäº†

ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆNuxt3ï¼‰ã¯å®Œäº†æ¸ˆã¿:
- admin-dashboard/: ç®¡ç†è€…å‘ã‘ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- ãƒ­ã‚°ã‚¤ãƒ³ã€å•é¡Œç®¡ç†ã€ã‚¯ã‚¤ã‚ºåˆ¶å¾¡ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆã€ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºæ©Ÿèƒ½
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³å¯¾å¿œ

### [å®Œäº†] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚¿ãƒ¼æŠ•å½±ç”¨ç”»é¢ã®å®Ÿè£…
- admin-dashboard/pages/projector.vue: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ
- admin-dashboard/layouts/projector.vue: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚¿ãƒ¼å°‚ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä½œæˆ
- å¤§ç”»é¢æœ€é©åŒ–ï¼ˆå¤§ããªãƒ•ã‚©ãƒ³ãƒˆã€é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã€ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ï¼‰
- å•é¡Œè¡¨ç¤ºæ©Ÿèƒ½ï¼ˆå•é¡Œç•ªå·ã€å•é¡Œæ–‡ã€4ã¤ã®é¸æŠè‚¢A/B/C/Dã€ç”»åƒè¡¨ç¤ºã‚¨ãƒªã‚¢ï¼‰
- ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½
- çµæœè¡¨ç¤ºæ©Ÿèƒ½ï¼ˆæ­£è§£ç™ºè¡¨ã€æ­£ç­”ç‡ã€å›ç­”åˆ†å¸ƒï¼‰
- WebSocketãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°å¯¾å¿œï¼ˆå•é¡Œåˆ‡ã‚Šæ›¿ãˆã€æŠ•ç¥¨çµ‚äº†ã€å›ç­”çŠ¶æ³æ›´æ–°ï¼‰
- ç®¡ç†ç”»é¢ã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚¿ãƒ¼ç”»é¢ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒœã‚¿ãƒ³è¿½åŠ 

### [å®Œäº†] ã‚³ãƒ¼ãƒ‰å“è³ªãƒ»ãƒªãƒ³ãƒˆãƒ»ãƒ†ã‚¹ãƒˆæœ€é©åŒ–
- **Goè¨€èªãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: golangci-lint ã‚¨ãƒ©ãƒ¼æ•°297â†’291ä»¶ã«å‰Šæ¸›
  - å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³å®‰å…¨åŒ–ï¼ˆãƒã‚§ãƒƒã‚¯ä»˜ãã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ï¼ˆ#nosec G304 ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ï¼‰
  - æœªä½¿ç”¨é–¢æ•°ãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‰Šé™¤ãƒ»ç„¡åŠ¹åŒ–
  - ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆé–¢æ•°ã®ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
  - å®šæ•°ä½¿ç”¨çµ±ä¸€ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ’²æ»…ï¼‰
  - ç©ºãƒ–ãƒ­ãƒƒã‚¯å‰Šé™¤ï¼ˆdefer ã§ã® _ = resource.Close()ï¼‰

- **Nuxt3ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**: å…¨14ãƒ†ã‚¹ãƒˆæˆåŠŸï¼ˆ100%ï¼‰
  - Chart.js ãƒ¢ãƒƒã‚¯ä¿®æ­£
  - Tailwind CSS è¨­å®šå•é¡Œè§£æ±º
  - Vue Test Utils ã«ã‚ˆã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
  - Vitest ã‚«ãƒãƒ¬ãƒƒã‚¸å¯¾å¿œ

- **Next.jså‚åŠ è€…ã‚¢ãƒ—ãƒª**: ESLint 100%æˆåŠŸ
  - TypeScript å³å¯†å‹ãƒã‚§ãƒƒã‚¯
  - React Hook é©åˆ‡ãªä½¿ç”¨
  - Jest + React Testing Library ãƒ†ã‚¹ãƒˆ

### [å®Œäº†] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ãƒ»é–‹ç™ºãƒ«ãƒ¼ãƒ«æ•´å‚™
- **ãƒ¡ã‚¤ãƒ³README.md**: å“è³ªã‚µãƒãƒªãƒ¼ãƒ»ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰è¿½åŠ 
- **CLAUDE.md**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»å“è³ªã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã€DDD/t-wada/BFFæ€æƒ³
- **admin-dashboard/README.md**: ãƒ†ã‚¹ãƒˆçŠ¶æ³ãƒ»é–‹ç™ºæ‰‹é †è©³ç´°åŒ–
- **participant-app/README.md**: å“è³ªç¢ºèªãƒ»æŠ€è¡“è©³ç´°è¿½åŠ 
- **å“è³ªæŒ‡æ¨™**: Go 85%ã‚«ãƒãƒ¬ãƒƒã‚¸ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰100%æˆåŠŸ

### [å®Œäº†] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ ãƒ†ã‚¹ãƒˆä¿®æ­£
- Go Backendå¤±æ•—ãƒ†ã‚¹ãƒˆã®ä¿®æ­£å®Œäº†
- test_data.sqlä½œæˆï¼ˆç®¡ç†è€…ã€å‚åŠ è€…ã€ã‚¯ã‚¤ã‚ºã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã€å›ç­”ãƒ‡ãƒ¼ã‚¿ï¼‰
- CIè¨­å®šæ›´æ–°ï¼ˆtest_data.sqlè‡ªå‹•èª­ã¿è¾¼ã¿ï¼‰
- docker-compose.test.ymlæ›´æ–°ï¼ˆãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å¯¾å¿œï¼‰

### å“è³ªçŠ¶æ³ã‚µãƒãƒªãƒ¼ï¼ˆ2025-07-03æ›´æ–°ï¼‰
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ | Lint | ãƒ†ã‚¹ãƒˆ | ãƒ“ãƒ«ãƒ‰ | ã‚«ãƒãƒ¬ãƒƒã‚¸ |
|------------|------|--------|--------|----------|
| Go Backend | âœ… å®Œå…¨å¯¾å¿œ | âœ… å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸ | âœ… æˆåŠŸ | 40.5% (æ”¹å–„) |
| Nuxt3 Dashboard | âœ… å®Œå…¨å¯¾å¿œ | âœ… 14/14æˆåŠŸ | âœ… æˆåŠŸ | Chart.jsçµ±åˆ |
| Next.js App | âœ… 100%æˆåŠŸ | âœ… æˆåŠŸ | âœ… ãƒ“ãƒ«ãƒ‰æˆåŠŸ | TypeScriptå³å¯† |

### [å®Œäº†] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ä¸¦åˆ—åŒ–ãƒ»é«˜é€ŸåŒ–å®Ÿè£…
- **ä¸¦åˆ—å®Ÿè¡Œã«ã‚ˆã‚‹CIé«˜é€ŸåŒ–**: å¾“æ¥ã®é †æ¬¡å®Ÿè¡Œã‹ã‚‰ä¸¦åˆ—å®Ÿè¡Œã«å¤‰æ›´ï¼ˆ3-5å€é«˜é€ŸåŒ–ï¼‰
- **Goå“è³ªãƒã‚§ãƒƒã‚¯ä¸¦åˆ—åŒ–**: formatã€lintã€vetã‚’ç‹¬ç«‹ã—ãŸã‚¸ãƒ§ãƒ–ã§åŒæ™‚å®Ÿè¡Œ
- **ãƒ†ã‚¹ãƒˆä¸¦åˆ—åŒ–**: å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆpackagesåˆ¥ï¼‰ã€çµ±åˆãƒ†ã‚¹ãƒˆã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆä¸¦åˆ—å®Ÿè¡Œ
- **é«˜åº¦ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥**: Goãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€lintã€ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ€é©åŒ–
- **ãƒãƒˆãƒªãƒƒã‚¯ã‚¹æˆ¦ç•¥**: å˜ä½“ãƒ†ã‚¹ãƒˆã‚’handlers/services/other(models,database,middleware,utils)ã«åˆ†å‰²
- **ã‚«ãƒãƒ¬ãƒƒã‚¸çµ±åˆ**: å„ãƒ†ã‚¹ãƒˆã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’çµ±åˆã—ã¦ç·åˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- **Makefileæœ€é©åŒ–**: ä¸¦åˆ—å®Ÿè¡Œå¯¾å¿œã€CIç‰¹åŒ–ã‚³ãƒãƒ³ãƒ‰ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹èª¿æ•´å¯èƒ½

#### å®Ÿè£…è©³ç´°
- **ä¸¦åˆ—ã‚¸ãƒ§ãƒ–**: go-format, go-lint, go-vet, go-unit-tests, go-integration-tests, go-performance-tests
- **ãƒ†ã‚¹ãƒˆé«˜é€ŸåŒ–**: `-parallel 8` (å˜ä½“ãƒ†ã‚¹ãƒˆ), `-parallel 4` (çµ±åˆãƒ†ã‚¹ãƒˆ)
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡åŒ–**: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆ¥ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã€golangci-lintå°‚ç”¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š**: çµ±åˆãƒ†ã‚¹ãƒˆ10åˆ†ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ15åˆ†
- **ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤**: 30%ä»¥ä¸Šã‚’ç¶­æŒ

#### é–‹ç™ºæ”¯æ´æ©Ÿèƒ½
- `make test-parallel`: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆ¥ä¸¦åˆ—ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- `make check`: format/lint/vetä¸¦åˆ—å®Ÿè¡Œ
- `make ci-test`: CIç’°å¢ƒæœ€é©åŒ–ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
- `PARALLELISM=16 make test`: ä¸¦åˆ—åº¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½

## ğŸš¨ CIå¤±æ•—è¦å› ã¨å¯¾å¿œã‚¿ã‚¹ã‚¯ï¼ˆç·Šæ€¥ï¼‰

### âœ… **CIä¿®æ­£çŠ¶æ³** (2025-07-03æ›´æ–°)
- **PR #34ä½œæˆæ¸ˆã¿**: DB_PORTä¿®æ­£ã‚’masterãƒ–ãƒ©ãƒ³ãƒã¸ãƒãƒ¼ã‚¸å¾…ã¡  
- **ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ**: å…¨Go ãƒ†ã‚¹ãƒˆæˆåŠŸï¼ˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã€çµ±åˆãƒ†ã‚¹ãƒˆå…±ã«ï¼‰
- **Next.jsãƒ“ãƒ«ãƒ‰**: æˆåŠŸï¼ˆSuspenseå•é¡Œã¯æ—¢ã«è§£æ±ºæ¸ˆã¿ï¼‰
- **ä¿®æ­£å®Œäº†**: CIå¤±æ•—ã®2ã¤ã®ä¸»è¦å•é¡Œï¼ˆDBæ¥ç¶šã€Next.js Suspenseï¼‰ã¯å¯¾å¿œæ¸ˆã¿

### ğŸ”´ **PR #23 CIå¤±æ•—çŠ¶æ³åˆ†æ** (2025-07-03 12:22-12:25 UTC)

#### CI-FAIL-001: Go Backend çµ±åˆãƒ†ã‚¹ãƒˆå¤±æ•—
**çŠ¶æ…‹**: ğŸ”´ å¤±æ•—  
**å•é¡Œ**: `integration_test.go` ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼
**ã‚¨ãƒ©ãƒ¼è©³ç´°**:
```
Failed to ping test database: dial tcp [::1]:5433: connect: connection refused
FAIL	github.com/Tattsum/quiz	0.022s
```
**åŸå› **: CIç’°å¢ƒã®DBç’°å¢ƒå¤‰æ•°ãŒãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆè¨­å®šã¨ä¸ä¸€è‡´
- CIç’°å¢ƒ: `DB_PORT: 5432` (GitHub Actions)
- ãƒ­ãƒ¼ã‚«ãƒ«: `DB_PORT: 5433` (test_helper.goä¿®æ­£æ¸ˆã¿)
**å¯¾å¿œ**: CIç’°å¢ƒå¤‰æ•°ã‚’DB_PORT=5433ã«ä¿®æ­£ãŒå¿…è¦

#### CI-FAIL-002: Next.js ãƒ“ãƒ«ãƒ‰å¤±æ•—  
**çŠ¶æ…‹**: ğŸ”´ å¤±æ•—  
**å•é¡Œ**: `useSearchParams()` ãŒSuspenseå¢ƒç•Œå¤–ã§ä½¿ç”¨
**ã‚¨ãƒ©ãƒ¼è©³ç´°**:
```
â¨¯ useSearchParams() should be wrapped in a suspense boundary at page "/". 
Read more: https://nextjs.org/docs/messages/missing-suspense-with-csr-bailout
```
**åŸå› **: Next.js 14ã®é™çš„ç”Ÿæˆæ™‚ã«useSearchParams()ãŒSuspenseã§ãƒ©ãƒƒãƒ—ã•ã‚Œã¦ã„ãªã„
**å¯¾å¿œ**: participant-app ã®ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«Suspenseè¿½åŠ ãŒå¿…è¦

#### CI-SUCCESS: æˆåŠŸé …ç›®
- âœ… **go-backend**: Lint, Format, Vet ã™ã¹ã¦é€šé
- âœ… **go-backend**: å˜ä½“ãƒ†ã‚¹ãƒˆ 40.5%ã‚«ãƒãƒ¬ãƒƒã‚¸ã§é€šé
- âœ… **nuxt-admin**: ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—æˆåŠŸ
- âœ… **nextjs-participant**: Lint, Test ã™ã¹ã¦é€šé

### ğŸ”´ **ç·Šæ€¥ä¿®æ­£ã‚¿ã‚¹ã‚¯**

#### TASK-001: CIç’°å¢ƒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šä¿®æ­£
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  
**ãƒ•ã‚¡ã‚¤ãƒ«**: `.github/workflows/ci.yml`  
**ä¿®æ­£å†…å®¹**:
```yaml
# Before
env:
  DB_PORT: 5432

# After  
env:
  DB_PORT: 5433
```
**å½±éŸ¿**: Go Backendçµ±åˆãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œå¯èƒ½ã«ãªã‚‹

#### TASK-002: Next.js useSearchParams Suspenseå¯¾å¿œ
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜  
**ãƒ•ã‚¡ã‚¤ãƒ«**: `participant-app/src/app/page.tsx`  
**ä¿®æ­£å†…å®¹**: useSearchParams()ã‚’Suspenseã§ãƒ©ãƒƒãƒ—
```tsx
// Before
export default function HomePage() {
  const searchParams = useSearchParams();
  // ...
}

// After
import { Suspense } from 'react';

function HomeContent() {
  const searchParams = useSearchParams();
  // ...
}

export default function HomePage() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <HomeContent />
    </Suspense>
  );
}
```
**å½±éŸ¿**: Next.jsé™çš„ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã™ã‚‹ã‚ˆã†ã«ãªã‚‹

### ğŸŸ¡ **å¾“æ¥ã®æ®‹èª²é¡Œï¼ˆå„ªå…ˆåº¦ï¼šä¸­ï¼‰**
*æ³¨ï¼šä¸Šè¨˜ã®TASK-001, 002ãŒå®Œäº†ã™ã‚Œã°CIé€šéå¯èƒ½*

#### TASK-003: å€‹åˆ¥ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆæ”¹å–„ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
**å„ªå…ˆåº¦**: ğŸŸ¡ ä¸­  
**å•é¡Œ**: ä¸€éƒ¨ã®å˜ä½“ãƒ†ã‚¹ãƒˆã§ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä¾å­˜ã«ã‚ˆã‚‹å¤±æ•—
- `TestSubmitAnswer`: "This quiz is not currently active" ã‚¨ãƒ©ãƒ¼  
- `TestGetQuiz`: ã‚¯ã‚¤ã‚ºID 1ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼
**å¯¾å¿œ**: ãƒ†ã‚¹ãƒˆç”¨ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹å‡¦ç†ã¨ã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿ä½œæˆ

#### TASK-004: golangci-lintã‚¨ãƒ©ãƒ¼æœ€çµ‚å¯¾å¿œï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
**å„ªå…ˆåº¦**: ğŸŸ¡ ä¸­  
**æ®‹ã‚Š**: 6ä»¶ã®lintã‚¨ãƒ©ãƒ¼ï¼ˆ291/297ä»¶å¯¾å¿œæ¸ˆã¿ï¼‰
**å¯¾å¿œ**: å®šæ•°ä½¿ç”¨ã€å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ç­‰ã®ä¿®æ­£

### âœ… **ä¿®æ­£å®Œäº†æ¸ˆã¿é …ç›®**
- âœ… **DBæ¥ç¶šè¨­å®š**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ãƒãƒ¼ãƒˆ5433ã«ä¿®æ­£æ¸ˆã¿
- âœ… **WebSocketãƒ†ã‚¹ãƒˆ**: nilãƒã‚¤ãƒ³ã‚¿ãƒ‘ãƒ‹ãƒƒã‚¯è§£æ¶ˆ
- âœ… **ç”»åƒã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆ**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹å•é¡Œè§£æ¶ˆ  
- âœ… **çµ±åˆãƒ†ã‚¹ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: APIãƒ‘ã‚¹çµ±ä¸€
- âœ… **åŸºæœ¬çš„ãªGoãƒ†ã‚¹ãƒˆ**: 40.5%ã‚«ãƒãƒ¬ãƒƒã‚¸ã§é€šé

## ğŸ“‹ **æ¬¡å›ä¿®æ­£æ‰‹é †ï¼ˆç·Šæ€¥ï¼‰**

1. **CIç’°å¢ƒå¤‰æ•°ä¿®æ­£**: `.github/workflows/ci.yml` ã® `DB_PORT: 5432` â†’ `5433`
2. **Next.js Suspenseè¿½åŠ **: `participant-app/src/app/page.tsx` ã«Suspenseå¢ƒç•Œè¿½åŠ 
3. **PRæ›´æ–°**: ä¿®æ­£å†…å®¹ã‚’ã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦CIå†å®Ÿè¡Œ
4. **CIé€šéç¢ºèª**: å…¨4ã¤ã®ã‚¸ãƒ§ãƒ–ï¼ˆgo-backend, nuxt-admin, nextjs-participant, integrationï¼‰æˆåŠŸç¢ºèª

**äºˆæƒ³çµæœ**: ä¸Šè¨˜2ç‚¹ä¿®æ­£ã§CIå®Œå…¨é€šéå¯èƒ½

## ğŸ’° å€‹äººé–‹ç™ºå‘ã‘ä½ã‚³ã‚¹ãƒˆã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆã‚¿ã‚¹ã‚¯ï¼ˆ2025å¹´12æœˆè¿½åŠ ï¼‰

### ğŸ“‹ å¿…è¦æœ€ä½é™ã®ã‚¤ãƒ³ãƒ•ãƒ©åŸºç›¤æ§‹ç¯‰

#### [TODO] VPSç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆæœˆé¡äºˆç®—: 2000-3000å††ï¼‰
- **VPSé¸å®š**: ã•ãã‚‰ã®VPS (2GB/2CPU) ã¾ãŸã¯ DigitalOcean Droplet ($20/æœˆ)
- **OSè¨­å®š**: Ubuntu 24.04 LTS, Docker, Docker Compose ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: SSHéµèªè¨¼ã€ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šã€fail2banå°å…¥
- **ãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—**: ãŠåå‰.com ã¾ãŸã¯ Cloudflare Registrarï¼ˆå¹´é¡1000å††ç¨‹åº¦ï¼‰

#### [TODO] Dockeræœ¬ç•ªç’°å¢ƒç”¨è¨­å®š
- **docker-compose.prod.yml** ä½œæˆï¼ˆæœ¬ç•ªç’°å¢ƒç”¨è¨­å®šï¼‰
- **ç’°å¢ƒå¤‰æ•°ç®¡ç†**: .env.production ä½œæˆã€æ©Ÿå¯†æƒ…å ±ã®ç’°å¢ƒå¤‰æ•°åŒ–
- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: å„ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯è¨­å®š
- **ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™**: memory, CPUåˆ¶é™è¨­å®šã§å®‰å®šç¨¼åƒç¢ºä¿

#### [TODO] ç„¡æ–™SSLè¨¼æ˜æ›¸ã¨HTTPSåŒ–
- **Let's Encrypt**: certbotä½¿ç”¨ã€SSLè¨¼æ˜æ›¸è‡ªå‹•å–å¾—ãƒ»æ›´æ–°
- **Nginxè¨­å®š**: SSLçµ‚ç«¯ã€HTTPâ†’HTTPS ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
- **è‡ªå‹•æ›´æ–°**: cron jobè¨­å®šï¼ˆè¨¼æ˜æ›¸ã®è‡ªå‹•æ›´æ–°ï¼‰
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼**: HSTSã€CSPç­‰ã®åŸºæœ¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¿½åŠ 

#### [TODO] ç„¡æ–™CDNå°å…¥ï¼ˆCloudflareç„¡æ–™ãƒ—ãƒ©ãƒ³ï¼‰
- **Cloudflare DNS**: ãƒ‰ãƒ¡ã‚¤ãƒ³ã®DNSç®¡ç†
- **CDNè¨­å®š**: é™çš„ã‚¢ã‚»ãƒƒãƒˆï¼ˆç”»åƒã€CSSã€JSï¼‰ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **DDoSä¿è­·**: Cloudflareã®ç„¡æ–™DDoSä¿è­·åˆ©ç”¨
- **SSLè¨­å®š**: Cloudflareå´ã®SSLè¨­å®š

### ğŸ”„ CI/CDè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒæ§‹ç¯‰

#### [TODO] GitHub Actions ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰
- **æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: `.github/workflows/deploy.yml` ä½œæˆ
- **ãƒ‡ãƒ—ãƒ­ã‚¤æ¡ä»¶**: main ãƒ–ãƒ©ãƒ³ãƒã¸ã®pushæ™‚ã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- **ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒ†ã‚¹ãƒˆ**: å…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè¡Œå¾Œã«ãƒ‡ãƒ—ãƒ­ã‚¤
- **ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½**: ãƒ‡ãƒ—ãƒ­ã‚¤å¤±æ•—æ™‚ã®è‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

#### [TODO] VPSã¸ã®å®‰å…¨ãªãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š
- **SSHéµè¨­å®š**: GitHub Actions ã‹ã‚‰VPSã¸ã®SSHæ¥ç¶šè¨­å®š
- **ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¦ãƒ¼ã‚¶ãƒ¼**: å°‚ç”¨ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã€sudoæ¨©é™åˆ¶é™
- **Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ç®¡ç†**: GitHub Container Registry ä½¿ç”¨ï¼ˆç„¡æ–™ï¼‰
- **ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `scripts/deploy.sh` ä½œæˆ

#### [TODO] ã‚¼ãƒ­ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè£…
- **Blue-Greené¢¨ãƒ‡ãƒ—ãƒ­ã‚¤**: Docker Compose ã§ã®ã‚³ãƒ³ãƒ†ãƒŠåˆ‡ã‚Šæ›¿ãˆ
- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®è‡ªå‹•ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- **ãƒ­ã‚°å‡ºåŠ›**: ãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ³ã®è©³ç´°ãƒ­ã‚°å‡ºåŠ›
- **Slacké€šçŸ¥**: ãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸãƒ»å¤±æ•—ã®Slacké€šçŸ¥ï¼ˆWebhookä½¿ç”¨ï¼‰

### ğŸ“Š ä½ã‚³ã‚¹ãƒˆç›£è¦–ãƒ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½“åˆ¶

#### [TODO] ç„¡æ–™ç›£è¦–ãƒ„ãƒ¼ãƒ«å°å…¥
- **UptimeRobot**: Webã‚µã‚¤ãƒˆç¨¼åƒç›£è¦–ï¼ˆç„¡æ–™ã§50ã‚µã‚¤ãƒˆã¾ã§ï¼‰
- **Grafana Cloud**: åŸºæœ¬ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç›£è¦–ï¼ˆç„¡æ–™æ : 10K metricsï¼‰
- **ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–**: VPSåŸºæœ¬ãƒªã‚½ãƒ¼ã‚¹ï¼ˆCPUã€ãƒ¡ãƒ¢ãƒªã€ãƒ‡ã‚£ã‚¹ã‚¯ï¼‰ç›£è¦–
- **ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š**: ãƒ€ã‚¦ãƒ³æ™‚ã®ãƒ¡ãƒ¼ãƒ«ãƒ»Slacké€šçŸ¥

#### [TODO] ç°¡æ˜“ãƒ­ã‚°ç®¡ç†
- **Docker logs**: ã‚³ãƒ³ãƒ†ãƒŠãƒ­ã‚°ã®ä¸€å…ƒç®¡ç†
- **logrotate**: ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
- **VPSãƒ­ã‚°ç›£è¦–**: ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ï¼ˆ/var/logï¼‰ã®ç›£è¦–
- **ãƒ­ã‚°ä¿å­˜æœŸé–“**: ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡è€ƒæ…®ã—ãŸé©åˆ‡ãªä¿å­˜æœŸé–“è¨­å®š

#### [TODO] ä½ã‚³ã‚¹ãƒˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥
- **VPSã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ**: é€±1å›ã®è‡ªå‹•ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼ˆVPSæ©Ÿèƒ½åˆ©ç”¨ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: æ—¥æ¬¡PostgreSQLãƒ€ãƒ³ãƒ—ã€ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜
- **ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: rsyncä½¿ç”¨ã€å¤–éƒ¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸åŒæœŸ
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¤œè¨¼**: æœˆ1å›ã®ãƒªã‚¹ãƒˆã‚¢ç¢ºèª

### ğŸ”§ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆç„¡æ–™ç¯„å›²ï¼‰

#### [TODO] Nginxæœ€é©åŒ–
- **gzipåœ§ç¸®**: ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®åœ§ç¸®è¨­å®š
- **é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: ç”»åƒã€CSSã€JSã®é©åˆ‡ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š
- **æ¥ç¶šæœ€é©åŒ–**: keep-aliveã€workerè¨­å®šã®èª¿æ•´
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ¶å¾¡ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®š

#### [TODO] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–
- **PostgreSQLè¨­å®š**: shared_buffersã€max_connectionsç­‰ã®èª¿æ•´
- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç¢ºèª**: æ—¢å­˜ã‚¯ã‚¨ãƒªã«å¯¾ã™ã‚‹é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®š
- **å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹**: VACUUMã€ANALYZE ã®å®šæœŸå®Ÿè¡Œ
- **æ¥ç¶šãƒ—ãƒ¼ãƒ«**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã®æ¥ç¶šãƒ—ãƒ¼ãƒ«è¨­å®š

#### [TODO] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ€é©åŒ–
- **é™çš„ãƒ•ã‚¡ã‚¤ãƒ«**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ã®æœ€é©åŒ–
- **ç”»åƒæœ€é©åŒ–**: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒã®è‡ªå‹•åœ§ç¸®ãƒ»ãƒªã‚µã‚¤ã‚º
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: Go ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–
- **WebSocketæœ€é©åŒ–**: æ¥ç¶šæ•°åˆ¶é™ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã®èª¿æ•´

### ğŸ¯ å€‹äººé–‹ç™ºå‘ã‘é”æˆç›®æ¨™ (6ãƒ¶æœˆå¾Œ)

- **æœˆé¡ã‚³ã‚¹ãƒˆ**: 3000å††ä»¥ä¸‹ï¼ˆVPS + ãƒ‰ãƒ¡ã‚¤ãƒ³ + ç›£è¦–ï¼‰
- **å¯ç”¨æ€§**: 99% ç¨¼åƒç‡é”æˆ
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“**: å¹³å‡ 1ç§’ä»¥ä¸‹
- **ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚é–“**: 5åˆ†ä»¥å†…ã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- **åŒæ™‚æ¥ç¶š**: 50-70äººå®‰å®šç¨¼åƒ

### ğŸ’¸ æƒ³å®šæœˆé¡ã‚³ã‚¹ãƒˆå†…è¨³

| é …ç›® | ã‚µãƒ¼ãƒ“ã‚¹ | æœˆé¡ã‚³ã‚¹ãƒˆ |
|------|----------|-----------|
| VPS | ã•ãã‚‰ã®VPS 2G | 1,738å†† |
| ãƒ‰ãƒ¡ã‚¤ãƒ³ | å¹´é¡Ã·12 | 83å†† |
| ç›£è¦– | UptimeRobotç„¡æ–™ | 0å†† |
| CDN | Cloudflareç„¡æ–™ | 0å†† |
| SSL | Let's Encrypt | 0å†† |
| **åˆè¨ˆ** | | **1,821å††/æœˆ** |

### ğŸ“‹ å®Ÿè£…å„ªå…ˆé †ä½

#### Phase 1 (1ãƒ¶æœˆç›®): åŸºç›¤æ§‹ç¯‰
1. VPSç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
2. Dockeræœ¬ç•ªç’°å¢ƒè¨­å®š
3. SSLè¨¼æ˜æ›¸ã¨HTTPSåŒ–

#### Phase 2 (2ãƒ¶æœˆç›®): CI/CDæ§‹ç¯‰  
1. GitHub Actions ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
2. VPSã¸ã®å®‰å…¨ãªãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š
3. ã‚¼ãƒ­ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãƒ‡ãƒ—ãƒ­ã‚¤

#### Phase 3 (3ãƒ¶æœˆç›®): ç›£è¦–ãƒ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
1. ç„¡æ–™ç›£è¦–ãƒ„ãƒ¼ãƒ«å°å…¥
2. ç°¡æ˜“ãƒ­ã‚°ç®¡ç†
3. ä½ã‚³ã‚¹ãƒˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥

#### Phase 4 (4-6ãƒ¶æœˆç›®): æœ€é©åŒ–
1. Nginxæœ€é©åŒ–
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–  
3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ€é©åŒ–

## ğŸš€ CI/CDè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè£…æ‰‹é †è©³ç´°

### ğŸ“‹ Step 1: VPSåˆæœŸè¨­å®š

#### [TODO] VPSåŸºæœ¬ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
# VPS SSHæ¥ç¶šå¾Œã®åˆæœŸè¨­å®š
sudo apt update && sudo apt upgrade -y
sudo apt install -y docker.io docker-compose-plugin nginx certbot python3-certbot-nginx fail2ban ufw

# Dockerè¨­å®š
sudo usermod -aG docker $USER
sudo systemctl enable docker
sudo systemctl start docker

# ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®š
sudo ufw allow ssh
sudo ufw allow 80
sudo ufw allow 443
sudo ufw --force enable

# ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
sudo adduser deploy
sudo usermod -aG docker deploy
sudo mkdir -p /home/deploy/.ssh
```

#### [TODO] SSHéµè¨­å®šã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã§SSHéµç”Ÿæˆï¼ˆGitHub Actionsç”¨ï¼‰
ssh-keygen -t ed25519 -f ~/.ssh/quiz_deploy_key -N ""

# VPSã«å…¬é–‹éµè¿½åŠ 
cat ~/.ssh/quiz_deploy_key.pub | ssh user@your-vps "sudo -u deploy tee -a /home/deploy/.ssh/authorized_keys"

# SSHè¨­å®šå¼·åŒ– (/etc/ssh/sshd_config)
# PasswordAuthentication no
# PubkeyAuthentication yes
# PermitRootLogin no
```

### ğŸ“‹ Step 2: æœ¬ç•ªç’°å¢ƒDockerè¨­å®š

#### [TODO] docker-compose.prod.ymlä½œæˆ
```yaml
# /home/deploy/quiz/docker-compose.prod.yml
version: '3.8'
services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: ${DB_NAME}
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./database_schema.sql:/docker-entrypoint-initdb.d/init.sql
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  redis:
    image: redis:7-alpine
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 128M

  api:
    image: ghcr.io/tattsum/quiz:${IMAGE_TAG}
    environment:
      DB_HOST: postgres
      DB_USER: ${DB_USER}
      DB_PASSWORD: ${DB_PASSWORD}
      DB_NAME: ${DB_NAME}
      REDIS_HOST: redis
      JWT_SECRET: ${JWT_SECRET}
      GIN_MODE: release
    ports:
      - "8080:8080"
    depends_on:
      - postgres
      - redis
    restart: unless-stopped
    volumes:
      - ./uploads:/app/uploads
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

volumes:
  postgres_data:
```

#### [TODO] æœ¬ç•ªç’°å¢ƒå¤‰æ•°è¨­å®š
```bash
# /home/deploy/quiz/.env.production
DB_NAME=quiz_db_prod
DB_USER=quiz_user
DB_PASSWORD=your_secure_password_here
JWT_SECRET=your_super_secure_jwt_secret_here
IMAGE_TAG=latest
```

### ğŸ“‹ Step 3: GitHub Actions ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

#### [TODO] .github/workflows/deploy.yml ä½œæˆ
```yaml
name: Deploy to Production

on:
  push:
    branches: [ main ]
  workflow_dispatch:

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: tattsum/quiz

jobs:
  test:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: quiz_test
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 5432:5432

    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-go@v4
      with:
        go-version: '1.21'

    - name: Run tests
      env:
        DATABASE_URL: postgres://postgres:postgres@localhost:5432/quiz_test?sslmode=disable
        JWT_SECRET: test_secret
      run: |
        go test -v ./...

  build-and-deploy:
    needs: test
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Log in to Container Registry
      uses: docker/login-action@v3
      with:
        registry: ${{ env.REGISTRY }}
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}

    - name: Build and push Docker image
      uses: docker/build-push-action@v5
      with:
        context: .
        push: true
        tags: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }},${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:latest

    - name: Deploy to VPS
      uses: appleboy/ssh-action@v1.0.0
      with:
        host: ${{ secrets.VPS_HOST }}
        username: deploy
        key: ${{ secrets.VPS_SSH_KEY }}
        script: |
          cd /home/deploy/quiz
          
          # æ–°ã—ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ã‚’è¨­å®š
          sed -i "s/IMAGE_TAG=.*/IMAGE_TAG=${{ github.sha }}/" .env.production
          
          # ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ—ãƒ«
          docker compose -f docker-compose.prod.yml pull
          
          # ã‚¼ãƒ­ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãƒ‡ãƒ—ãƒ­ã‚¤
          docker compose -f docker-compose.prod.yml up -d --force-recreate
          
          # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
          sleep 10
          if curl -f http://localhost:8080/api/health; then
            echo "âœ… Deployment successful"
            # å¤ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
            docker image prune -f
          else
            echo "âŒ Deployment failed"
            exit 1
          fi

    - name: Notify Slack
      if: always()
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        text: |
          Deployment ${{ job.status }}!
          Commit: ${{ github.sha }}
          Author: ${{ github.actor }}
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
```

#### [TODO] GitHub Secretsè¨­å®š
```
å¿…è¦ãªSecrets:
- VPS_HOST: VPSã®IPã‚¢ãƒ‰ãƒ¬ã‚¹
- VPS_SSH_KEY: SSHç§˜å¯†éµã®å†…å®¹
- SLACK_WEBHOOK_URL: Slacké€šçŸ¥ç”¨Webhook URLï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```

### ğŸ“‹ Step 4: ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ

#### [TODO] scripts/deploy.sh ä½œæˆ
```bash
#!/bin/bash
# scripts/deploy.sh

set -e

echo "ğŸš€ Starting deployment..."

# è¨­å®šå¤‰æ•°
DEPLOY_DIR="/home/deploy/quiz"
COMPOSE_FILE="docker-compose.prod.yml"
BACKUP_DIR="/home/deploy/backups"

# ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
echo "ğŸ“¦ Creating backup..."
mkdir -p $BACKUP_DIR
docker compose -f $COMPOSE_FILE exec -T postgres pg_dump -U quiz_user quiz_db_prod > $BACKUP_DIR/backup_$(date +%Y%m%d_%H%M%S).sql

# æ–°ã—ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒ«
echo "â¬‡ï¸ Pulling new images..."
docker compose -f $COMPOSE_FILE pull

# ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
echo "ğŸ”„ Updating services..."
docker compose -f $COMPOSE_FILE up -d --force-recreate

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
echo "ğŸ” Health checking..."
sleep 15

if curl -f http://localhost:8080/api/health; then
  echo "âœ… Deployment successful!"
  
  # å¤ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  docker image prune -f
  
  # å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆ7æ—¥ä»¥ä¸Šå‰ï¼‰
  find $BACKUP_DIR -name "backup_*.sql" -mtime +7 -delete
  
else
  echo "âŒ Health check failed, rolling back..."
  
  # ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
  echo "ğŸ”™ Rolling back..."
  # å‰ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ã«æˆ»ã™å‡¦ç†
  exit 1
fi

echo "ğŸ‰ Deployment completed successfully!"
```

### ğŸ“‹ Step 5: Nginxè¨­å®š

#### [TODO] /etc/nginx/sites-available/quiz ä½œæˆ
```nginx
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;

    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;

    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    # gzipåœ§ç¸®
    gzip on;
    gzip_vary on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # API ãƒ—ãƒ­ã‚­ã‚·
    location /api/ {
        proxy_pass http://localhost:8080/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocket ãƒ—ãƒ­ã‚­ã‚·
    location /ws {
        proxy_pass http://localhost:8080/ws;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 86400;
    }

    # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
    location /uploads/ {
        alias /home/deploy/quiz/uploads/;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆå°†æ¥çš„ã«ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ä¿¡ï¼‰
    location / {
        try_files $uri $uri/ =404;
    }
}
```

### ğŸ“‹ Step 6: SSLè¨¼æ˜æ›¸è¨­å®š

#### [TODO] Let's Encryptè¨­å®š
```bash
# SSLè¨¼æ˜æ›¸å–å¾—
sudo certbot --nginx -d your-domain.com

# è‡ªå‹•æ›´æ–°è¨­å®š
sudo crontab -e
# ä»¥ä¸‹ã‚’è¿½åŠ :
# 0 12 * * * /usr/bin/certbot renew --quiet && systemctl reload nginx
```

### ğŸ“‹ Step 7: ç›£è¦–è¨­å®š

#### [TODO] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 
```go
// main.go ã«è¿½åŠ 
func healthCheck(c *gin.Context) {
    c.JSON(200, gin.H{
        "status": "healthy",
        "timestamp": time.Now(),
        "version": "1.0.0",
    })
}

// ãƒ«ãƒ¼ãƒˆè¿½åŠ 
router.GET("/api/health", healthCheck)
```

ã“ã®è©³ç´°ãªæ‰‹é †ã«ã‚ˆã‚Šã€**æœˆé¡2000å††æœªæº€**ã§å®‰å®šã—ãŸCI/CDç’°å¢ƒã‚’æ§‹ç¯‰ã—ã€ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã ã‘ã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ç’°å¢ƒãŒå®Ÿç¾ã§ãã¾ã™ã€‚
